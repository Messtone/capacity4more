<?php
/**
 * @file
 * Code for the Date field feature.
 */

include_once 'c4m_field_date.features.inc';

/**
 * Implements hook_field_formatter_info().
 */
function c4m_field_date_field_formatter_info() {
  $formatters = array(
    'c4m_field_date_format_interval' => array(
      'label' => t('C4M time ago'),
      'field types' => array('date', 'datestamp', 'datetime'),
      'settings' => array(
        'interval' => 2,
        'interval_display' => 'time ago',
      ),
    ),
  );
  return $formatters;
}

/**
 * Implements hook_field_formatter_view().
 *
 * @see media_field_formatter_info()
 */
function c4m_field_date_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $element = array();

  if ($display['type'] == 'c4m_field_date_format_interval') {
    $settings = $display['settings'];
    $element  = array();
    foreach ($items as $delta => $item) {
      $element[$delta] = array(
        '#theme' => 'c4m_field_date_format_interval',
        '#delta' => $delta,
        '#item' => $item,
        '#interval'  => $settings['interval'],
        '#interval_display'  => $settings['interval_display'],
      );
    }
  }

  return $element;
}

/**
 * Implements hook_theme().
 */
function c4m_field_date_theme() {
  return array(
    'c4m_field_date_format_interval' => array(
      'variables' => array(
        'delta' => NULL,
        'item' => NULL,
        'interval' => NULL,
        'interval_display' => NULL
      ),
      'file'      => 'includes/c4m_field_date.theme.inc',
    ),
  );
}
